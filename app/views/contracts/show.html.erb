<div class="container mt-4">

  <% if @new_contract_created %>
    <div class="alert alert-success" role="alert">
      <h4 class="alert-heading">Congratulations!</h4>
        <p>Your contract has been created successfully! If you want to review the information of your contract visit your dashboard.</p>
    </div>
  <% end %>

  <% if @contract && @user %>

    <h2>Contract Details</h2>

    <p><strong>Client:</strong> <%= @contract.user.first_name %> <%= @contract.user.last_name %></p>
    <p><strong>Contracted Service:</strong> <%= @contract.service.name_service %></p>
    <p><strong>Service Provider:</strong> <%= @contract.service.user.first_name %> <%= @contract.service.user.last_name %></p>
    <p><strong>Date of Service:</strong> <%= @contract.date %></p>
    <p><strong>Service Price:</strong> <%= @contract.service.price %></p>

    <% if @contract.status == "Pending" %>
      <p class="d-inline-flex"><strong>Service Status:</strong> <p class="d-inline-flex p-2 ms-2 border border-warning text-warning"><%= @contract.status %></p></p>
    <% elsif @contract.status == "Accepted" %>
      <p class="d-inline-flex"><strong>Service Status:</strong> <p class="d-inline-flex p-2 ms-2 border border-success text-success"><%= @contract.status %></p></p>
    <% else %>
      <p class="d-inline-flex"><strong>Service Status:</strong> <p class="d-inline-flex p-2 ms-2 border border-danger text-danger"><%= @contract.status %></p></p>
    <% end %>

    <% if @contract.user == current_user && @contract.status != 'Pending' %> <!-- Verifica se o usuário é o cliente -->
      <div class="d-flex align-items-center">
        <p><strong>Has the contract been completed?</strong></p> <%= button_to 'Yes', done_path(id: @contract.id, done: true), method: :patch, data: { "turbo-method": :patch }, class: "btn-yellow mx-3" %>
      </div>
    <% end %>

    <% if @contract.status == 'Pending' && @contract.service.user == current_user %> <!-- Verifica se o contrato ainda esta pendete e se o usuário é o prestador de serviços -->
      <div class="d-flex align-items-center">
        <p><strong>Do you accept the contract?</strong></p>
          <%= button_to 'Yes', update_status_path(id: @contract.id, status: 'Accepted'), method: :patch, data: { "turbo-method": :patch }, class: "btn-yellow mx-2" %>
          <%= button_to 'No', update_status_path(id: @contract.id, status: 'Rejected'), method: :patch, data: { "turbo-method": :patch }, class: "btn-yellow mx-2" %>
      </div>
    <% end %>

    <%= link_to "Leave a Review", new_user_service_contract_review_path(user_id: @contract.user.id, service_id: @contract.service.id, contract_id: @contract.id), class: "btn-yellow mt-4" %>

    <%= link_to 'Back to dashboard', dashboard_path(id: @contract.id), class: "btn-yellow mt-4" %>

  <% else %>
    <p>Contract not found.</p>
  <% end %>
</div>
